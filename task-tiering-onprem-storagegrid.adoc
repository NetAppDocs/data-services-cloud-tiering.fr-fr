---
sidebar: sidebar 
permalink: task-tiering-onprem-storagegrid.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, storagegrid, tier to storagegrid, fabricpool storagegrid 
summary: 'Libérez de l"espace sur vos clusters ONTAP sur site en hiérarchisant les données inactives vers StorageGRID dans NetApp Cloud Tiering.' 
---
= Hiérarchisation des données des clusters ONTAP sur site vers StorageGRID dans NetApp Cloud Tiering
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Libérez de l'espace sur vos clusters ONTAP sur site en hiérarchisant les données inactives vers StorageGRID dans NetApp Cloud Tiering.



== Démarrage rapide

Commencez rapidement en suivant ces étapes ou faites défiler les sections restantes pour obtenir tous les détails.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["Un"]Préparez-vous à hiérarchiser les données vers StorageGRID
[role="quick-margin-para"]
Vous avez besoin des éléments suivants :

[role="quick-margin-list"]
* Un cluster ONTAP source sur site exécutant ONTAP 9.4 ou une version ultérieure que vous avez ajouté à la console NetApp et une connexion via un port spécifié par l'utilisateur à StorageGRID. https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^] .
* StorageGRID 10.3 ou version ultérieure avec des clés d’accès AWS disposant d’autorisations S3.
* Un agent de console installé dans vos locaux.
* Mise en réseau pour l'agent qui permet une connexion HTTPS sortante au cluster ONTAP , à StorageGRID et au service Cloud Tiering.


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["Deux"]Configurer la hiérarchisation
[role="quick-margin-para"]
Dans la console NetApp , sélectionnez un système sur site, sélectionnez *Activer* pour la hiérarchisation du cloud et suivez les invites pour hiérarchiser les données vers StorageGRID.



== Exigences

Vérifiez la prise en charge de votre cluster ONTAP , configurez votre réseau et préparez votre stockage d’objets.

L'image suivante montre chaque composant et les connexions que vous devez préparer entre eux :

image:diagram_cloud_tiering_storagegrid.png["Une image d’architecture qui montre le service Cloud Tiering avec une connexion à l’agent sur vos locaux, l’agent avec une connexion à votre cluster ONTAP et une connexion entre le cluster ONTAP et le stockage d’objets.  Les données actives résident sur le cluster ONTAP , tandis que les données inactives résident dans le stockage d'objets."]


NOTE: La communication entre l'agent et StorageGRID est destinée uniquement à la configuration du stockage d'objets.



=== Préparez vos clusters ONTAP

Vos clusters ONTAP doivent répondre aux exigences suivantes lors de la hiérarchisation des données vers StorageGRID.

Plateformes ONTAP prises en charge::
+
--
* Lorsque vous utilisez ONTAP 9.8 et versions ultérieures : vous pouvez hiérarchiser les données des systèmes AFF ou des systèmes FAS avec des agrégats entièrement SSD ou des agrégats entièrement HDD.
* Lorsque vous utilisez ONTAP 9.7 et versions antérieures : vous pouvez hiérarchiser les données des systèmes AFF ou des systèmes FAS avec des agrégats entièrement SSD.


--
Version ONTAP prise en charge:: ONTAP 9.4 ou version ultérieure
Licences:: Aucune licence Cloud Tiering n'est requise dans votre organisation NetApp Console, ni aucune licence FabricPool sur le cluster ONTAP , lors de la hiérarchisation des données vers StorageGRID.
Exigences de mise en réseau des clusters::
+
--
* Le cluster ONTAP initie une connexion HTTPS via un port spécifié par l'utilisateur vers le nœud de passerelle StorageGRID (le port est configurable lors de la configuration de la hiérarchisation).
+
ONTAP lit et écrit des données vers et depuis le stockage d'objets.  Le stockage d'objets ne s'initialise jamais, il répond simplement.

* Une connexion entrante est requise de la part de l'agent, qui doit résider dans vos locaux.
+
Une connexion entre le cluster et le service Cloud Tiering n'est pas requise.

* Un LIF intercluster est requis sur chaque nœud ONTAP qui héberge les volumes que vous souhaitez hiérarchiser.  Le LIF doit être associé à l'_IPspace_ ONTAP doit utiliser pour se connecter au stockage d'objets.
+
Lorsque vous configurez la hiérarchisation des données, Cloud Tiering vous invite à indiquer l'espace IP à utiliser.  Vous devez choisir l’espace IP auquel chaque LIF est associé.  Il peut s'agir de l'espace IP « par défaut » ou d'un espace IP personnalisé que vous avez créé.  En savoir plus sur https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Les LIF"^] et https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["Espaces IP"^] .



--
Volumes et agrégats pris en charge:: Le nombre total de volumes que Cloud Tiering peut hiérarchiser peut être inférieur au nombre de volumes sur votre système ONTAP .  C'est parce que les volumes ne peuvent pas être hiérarchisés à partir de certains agrégats.  Consultez la documentation ONTAP pour https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["fonctionnalités ou caractéristiques non prises en charge par FabricPool"^] .



NOTE: Cloud Tiering prend en charge les volumes FlexGroup , à partir d' ONTAP 9.5.  La configuration fonctionne de la même manière que n’importe quel autre volume.



=== Découvrez un cluster ONTAP

Vous devez ajouter un système ONTAP sur site à la console NetApp avant de pouvoir commencer la hiérarchisation des données froides.

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^] .



=== Préparer StorageGRID

StorageGRID doit répondre aux exigences suivantes.

Versions de StorageGRID prises en charge:: StorageGRID 10.3 et versions ultérieures sont pris en charge.
Informations d'identification S3:: Lorsque vous configurez la hiérarchisation sur StorageGRID, vous devez fournir à Cloud Tiering une clé d'accès S3 et une clé secrète.  Cloud Tiering utilise les clés pour accéder à vos buckets.
+
--
Ces clés d’accès doivent être associées à un utilisateur disposant des autorisations suivantes :

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--
Versionnage d'objet:: Vous ne devez pas activer le contrôle de version des objets StorageGRID sur le bucket du magasin d'objets.




=== Créer ou changer d'agents de console

L'agent de console est requis pour hiérarchiser les données vers le cloud.  Lors de la hiérarchisation des données vers StorageGRID, un agent doit être disponible dans vos locaux.

Vous devez disposer du rôle d’administrateur d’organisation pour créer un agent.

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["En savoir plus sur les agents"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-on-prem.html["Installer et configurer un agent sur site"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["Basculer entre les agents"^]




=== Préparer la mise en réseau pour l'agent de la console

Assurez-vous que l'agent dispose des connexions réseau requises.

.Étapes
. Assurez-vous que le réseau sur lequel l'agent est installé permet les connexions suivantes :
+
** Une connexion HTTPS via le port 443 au service Cloud Tiering(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-on-prem.html#endpoints-contacted-for-day-to-day-operations["voir la liste des points de terminaison"^] )
** Une connexion HTTPS sur le port 443 vers votre système StorageGRID
** Une connexion HTTPS via le port 443 vers votre LIF de gestion de cluster ONTAP






== Transférez les données inactives de votre premier cluster vers StorageGRID

Après avoir préparé votre environnement, commencez à hiérarchiser les données inactives de votre premier cluster.

.Ce dont vous aurez besoin
* https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Un système sur site ajouté à la console NetApp"^] .
* Le nom de domaine complet du nœud de passerelle StorageGRID et le port qui sera utilisé pour les communications HTTPS.
* Une clé d’accès AWS disposant des autorisations S3 requises.


.Étapes
. Sélectionnez le système ONTAP sur site.
. Cliquez sur *Activer* pour la hiérarchisation du cloud dans le panneau de droite.
+
Si la destination de hiérarchisation StorageGRID existe en tant que système dans la console NetApp , vous pouvez faire glisser le cluster sur le système StorageGRID pour lancer l'assistant de configuration.

+
image:screenshot_setup_tiering_onprem.png["Une capture d’écran qui montre l’option Configurer la hiérarchisation qui apparaît sur le côté droit de l’écran après avoir sélectionné un système ONTAP sur site."]

. *Définir le nom du stockage d’objets* : saisissez un nom pour ce stockage d’objets.  Il doit être unique par rapport à tout autre stockage d’objets que vous pouvez utiliser avec des agrégats sur ce cluster.
. *Sélectionner le fournisseur* : Sélectionnez * StorageGRID* et sélectionnez *Continuer*.
. *Sélectionner le fournisseur* : Sélectionnez * StorageGRID* et sélectionnez *Continuer*.
. Suivez les étapes des pages *Créer un stockage d'objets* :
+
.. *Serveur* : saisissez le nom de domaine complet (FQDN) du nœud de passerelle StorageGRID , le port ONTAP doit utiliser pour la communication HTTPS avec StorageGRID, ainsi que la clé d'accès et la clé secrète d'un compte disposant des autorisations S3 requises.
.. *Bucket* : ajoutez un nouveau bucket ou sélectionnez un bucket existant qui commence par le préfixe _fabric-pool_ et sélectionnez *Continuer*.
.. *Bucket* : ajoutez un nouveau bucket ou sélectionnez un bucket existant qui commence par le préfixe _fabric-pool_ et sélectionnez *Continuer*.
+
Le préfixe _fabric-pool_ est requis car la stratégie IAM de l'agent permet à l'instance d'effectuer des actions S3 sur les buckets nommés avec ce préfixe exact.  Par exemple, vous pouvez nommer le bucket S3 _fabric-pool-AFF1_, où AFF1 est le nom du cluster.

.. *Réseau de cluster* : sélectionnez l'espace IP ONTAP doit utiliser pour se connecter au stockage d'objets et sélectionnez *Continuer*.
.. *Réseau de cluster* : sélectionnez l'espace IP ONTAP doit utiliser pour se connecter au stockage d'objets et sélectionnez *Continuer*.
+
La sélection de l'espace IP correct garantit que Cloud Tiering peut établir une connexion d' ONTAP au stockage d'objets StorageGRID .

+
Vous pouvez également définir la bande passante réseau disponible pour télécharger des données inactives vers le stockage d'objets en définissant le « Taux de transfert maximal ».  Sélectionnez le bouton radio *Limité* et entrez la bande passante maximale pouvant être utilisée, ou sélectionnez *Illimité* pour indiquer qu'il n'y a pas de limite.



. Sur la page _Volumes hiérarchisés_, sélectionnez les volumes pour lesquels vous souhaitez configurer la hiérarchisation et lancez la page Politique de hiérarchisation :
+
** Pour sélectionner tous les volumes, cochez la case dans la ligne de titre (image:button_backup_all_volumes.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner plusieurs volumes, cochez la case correspondant à chaque volume (image:button_backup_1_volume.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner un seul volume, sélectionnez la ligne (ouimage:screenshot_edit_icon.gif["modifier l'icône du crayon"] icône) pour le volume.
** Pour sélectionner tous les volumes, cochez la case dans la ligne de titre (image:button_backup_all_volumes.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner plusieurs volumes, cochez la case correspondant à chaque volume (image:button_backup_1_volume.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner un seul volume, sélectionnez la ligne (ouimage:screenshot_edit_icon.gif["modifier l'icône du crayon"] icône) pour le volume.
+
image:screenshot_tiering_initial_volumes.png["Une capture d'écran qui montre comment sélectionner un seul volume, plusieurs volumes ou tous les volumes, et le bouton Modifier les volumes sélectionnés."]



. Dans la boîte de dialogue _Politique de hiérarchisation_, sélectionnez une politique de hiérarchisation, ajustez éventuellement les jours de refroidissement pour les volumes sélectionnés et sélectionnez *Appliquer*.
. Dans la boîte de dialogue _Politique de hiérarchisation_, sélectionnez une politique de hiérarchisation, ajustez éventuellement les jours de refroidissement pour les volumes sélectionnés et sélectionnez *Appliquer*.
+
link:concept-cloud-tiering.html#volume-tiering-policies["En savoir plus sur les politiques de hiérarchisation des volumes et les jours de refroidissement"] .

+
image:screenshot_tiering_initial_policy_settings.png["Une capture d’écran qui montre les paramètres de stratégie de hiérarchisation configurables."]



.Quelle est la prochaine étape ?
Vous pouvez consulter les informations sur les données actives et inactives du cluster. link:task-managing-tiering.html["En savoir plus sur la gestion de vos paramètres de hiérarchisation"] .

Vous pouvez également créer un stockage d'objets supplémentaire dans les cas où vous souhaitez hiérarchiser les données de certains agrégats d'un cluster vers différents magasins d'objets.  Ou si vous prévoyez d'utiliser FabricPool Mirroring où vos données hiérarchisées sont répliquées vers un magasin d'objets supplémentaire. link:task-managing-object-storage.html["En savoir plus sur la gestion des magasins d'objets"] .
