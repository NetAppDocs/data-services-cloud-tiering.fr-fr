---
sidebar: sidebar 
permalink: task-tiering-onprem-storagegrid.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, storagegrid, tier to storagegrid, fabricpool storagegrid 
summary: 'Libérez de l"espace sur vos clusters ONTAP sur site en transférant les données inactives vers StorageGRID dans NetApp Cloud Tiering.' 
---
= Hiérarchisation des données des clusters ONTAP sur site vers StorageGRID dans NetApp Cloud Tiering
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Libérez de l'espace sur vos clusters ONTAP sur site en transférant les données inactives vers StorageGRID dans NetApp Cloud Tiering.



== Démarrage rapide

Commencez rapidement en suivant ces étapes ou faites défiler les sections restantes pour obtenir tous les détails.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["Un"]Préparez-vous à hiérarchiser les données vers StorageGRID.
[role="quick-margin-para"]
Vous avez besoin des éléments suivants :

[role="quick-margin-list"]
* Un cluster ONTAP source sur site exécutant ONTAP 9.4 ou une version ultérieure que vous avez ajouté à la NetApp Console, et une connexion via un port spécifié par l'utilisateur à StorageGRID. https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^] .
* StorageGRID 10.3 ou version ultérieure avec des clés d'accès AWS disposant des autorisations S3.
* Un agent Console installé sur vos locaux.
* Mise en réseau de l'agent qui permet une connexion HTTPS sortante vers le cluster ONTAP , vers StorageGRID et vers le service Cloud Tiering.


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["Deux"]Mettre en place une hiérarchisation
[role="quick-margin-para"]
Dans la NetApp Console, sélectionnez un système sur site, sélectionnez *Activer* pour la hiérarchisation vers le cloud et suivez les instructions pour hiérarchiser les données vers StorageGRID.



== Exigences

Vérifiez la compatibilité avec votre cluster ONTAP , configurez votre réseau et préparez votre stockage d'objets.

L'image suivante montre chaque composant et les connexions que vous devez préparer entre eux :

image:diagram_cloud_tiering_storagegrid.png["Une image d'architecture montrant le service Cloud Tiering avec une connexion à l'agent sur vos locaux, l'agent avec une connexion à votre cluster ONTAP et une connexion entre le cluster ONTAP et le stockage d'objets.  Les données actives résident sur le cluster ONTAP , tandis que les données inactives résident dans le stockage objet."]


NOTE: La communication entre l'agent et StorageGRID est réservée à la configuration du stockage d'objets.



=== Préparez vos clusters ONTAP

Vos clusters ONTAP doivent répondre aux exigences suivantes lors de la hiérarchisation des données vers StorageGRID.

Plateformes ONTAP prises en charge::
+
--
* Lors de l'utilisation ONTAP 9.8 et versions ultérieures : vous pouvez hiérarchiser les données provenant de systèmes AFF ou de systèmes FAS avec des agrégats entièrement SSD ou des agrégats entièrement HDD.
* Lors de l'utilisation ONTAP 9.7 et versions antérieures : vous pouvez hiérarchiser les données provenant de systèmes AFF ou de systèmes FAS avec des agrégats entièrement SSD.


--
Version ONTAP prise en charge:: ONTAP 9.4 ou version ultérieure
Licences:: Aucune licence Cloud Tiering n'est requise dans votre organisation NetApp Console , ni aucune licence FabricPool sur le cluster ONTAP , lors de la hiérarchisation des données vers StorageGRID.
exigences de mise en réseau du cluster::
+
--
* Le cluster ONTAP initie une connexion HTTPS via un port spécifié par l'utilisateur vers le nœud de passerelle StorageGRID (le port est configurable lors de la configuration de la hiérarchisation).
+
ONTAP lit et écrit des données vers et depuis le stockage d'objets. Le stockage d'objets ne s'initialise jamais, il répond simplement.

* Une connexion entrante est requise de la part de l'agent, qui doit se trouver dans vos locaux.
+
Aucune connexion n'est requise entre le cluster et le service Cloud Tiering.

* Une interface LIF inter-cluster est requise sur chaque nœud ONTAP hébergeant les volumes que vous souhaitez hiérarchiser.  L'interface LIF doit être associée à l'espace IP que ONTAP doit utiliser pour se connecter au stockage d'objets.
+
Lorsque vous configurez la hiérarchisation des données, Cloud Tiering vous invite à indiquer l'espace IP à utiliser. Vous devez choisir l’espace IP auquel chaque LIF est associé. Il peut s'agir de l'espace IP « par défaut » ou d'un espace IP personnalisé que vous avez créé.  Apprenez-en davantage sur https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Les LIF"^] et https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["Espaces IP"^] .



--
Volumes et agrégats pris en charge:: Le nombre total de volumes que Cloud Tiering peut hiérarchiser peut être inférieur au nombre de volumes présents sur votre système ONTAP .  C'est parce que les volumes ne peuvent pas être hiérarchisés à partir de certains agrégats.  Consultez la documentation ONTAP pour https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["fonctionnalités ou caractéristiques non prises en charge par FabricPool"^] .



NOTE: Cloud Tiering prend en charge les volumes FlexGroup , à partir d' ONTAP 9.5.  La configuration fonctionne de la même manière que pour n'importe quel autre volume.



=== Découvrez un cluster ONTAP

Vous devez ajouter un système ONTAP local à la NetApp Console avant de pouvoir commencer la hiérarchisation des données froides.

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^].



=== Préparer StorageGRID

StorageGRID doit répondre aux exigences suivantes.

Versions de StorageGRID prises en charge:: StorageGRID 10.3 et versions ultérieures sont pris en charge.
Informations d'identification S3:: Lorsque vous configurez la hiérarchisation vers StorageGRID, vous devez fournir à Cloud Tiering une clé d'accès S3 et une clé secrète.  Cloud Tiering utilise les clés pour accéder à vos compartiments.
+
--
Ces clés d’accès doivent être associées à un utilisateur disposant des autorisations suivantes :

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--
Versionnage d'objet:: Vous ne devez pas activer le versionnage des objets StorageGRID sur le compartiment de stockage d'objets.




=== Créer ou changer d'agents de console

L'agent Console est nécessaire pour transférer les données vers le cloud.  Lors du transfert de données vers StorageGRID, un agent doit être disponible sur vos locaux.

Vous devez posséder le rôle d'administrateur de l'organisation pour créer un agent.

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["Découvrez les agents"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-on-prem.html["Installer et configurer un agent sur site"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["Changer d'agent"^]




=== Préparer la mise en réseau pour l'agent de la console

Assurez-vous que l'agent dispose des connexions réseau requises.

.Étapes
. Assurez-vous que le réseau sur lequel l'agent est installé autorise les connexions suivantes :
+
** Une connexion HTTPS via le port 443 au service Cloud Tiering(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-on-prem.html#endpoints-contacted-for-day-to-day-operations["voir la liste des points de terminaison"^] )
** Une connexion HTTPS via le port 443 à votre système StorageGRID
** Une connexion HTTPS via le port 443 vers votre LIF de gestion de cluster ONTAP






== Stockez les données inactives de votre premier cluster vers StorageGRID.

Une fois votre environnement préparé, commencez à hiérarchiser les données inactives de votre premier cluster.

.Ce dont vous aurez besoin
* https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Un système sur site a été ajouté à la NetApp Console."^].
* Le nom de domaine complet (FQDN) du nœud de passerelle StorageGRID et le port qui sera utilisé pour les communications HTTPS.
* Une clé d'accès AWS disposant des autorisations S3 requises.


.Étapes
. Sélectionnez le système ONTAP sur site.
. Cliquez sur *Activer* pour la hiérarchisation cloud dans le panneau de droite.
+
Si la destination de hiérarchisation StorageGRID existe en tant que système dans la NetApp Console, vous pouvez faire glisser le cluster sur le système StorageGRID pour lancer l'assistant d'installation.

+
image:screenshot_setup_tiering_onprem.png["Capture d'écran montrant l'option « Configurer la hiérarchisation » qui apparaît sur le côté droit de l'écran après avoir sélectionné un système ONTAP sur site."]

. *Définir le nom du stockage d'objets* : Saisissez un nom pour ce stockage d'objets.  Il doit être unique par rapport à tout autre stockage d'objets que vous pourriez utiliser avec des agrégats sur ce cluster.
. *Sélectionnez le fournisseur* : Sélectionnez * StorageGRID* et sélectionnez *Continuer*.
. Suivez les étapes décrites sur les pages *Créer un stockage d'objets* :
+
.. *Serveur* : Saisissez le nom de domaine complet (FQDN) du nœud de passerelle StorageGRID , le port ONTAP doit utiliser pour la communication HTTPS avec StorageGRID, ainsi que la clé d’accès et la clé secrète d’un compte disposant des autorisations S3 requises.
.. *Bucket* : Ajoutez un nouveau bucket ou sélectionnez un bucket existant commençant par le préfixe _fabric-pool_ et sélectionnez *Continuer*.
+
Le préfixe _fabric-pool_ est requis car la stratégie IAM de l'agent autorise l'instance à effectuer des actions S3 sur des compartiments nommés avec ce préfixe exact.  Par exemple, vous pourriez nommer le compartiment S3 _fabric-pool-AFF1_, où AFF1 est le nom du cluster.

.. *Réseau de cluster* : Sélectionnez l’espace IP ONTAP doit utiliser pour se connecter au stockage d’objets et sélectionnez *Continuer*.
+
Le choix de l'espace IP approprié garantit que Cloud Tiering peut établir une connexion entre ONTAP et le stockage d'objets StorageGRID .

+
Vous pouvez également définir la bande passante réseau disponible pour le transfert des données inactives vers le stockage d'objets en définissant le « débit de transfert maximal ». Sélectionnez le bouton radio *Limité* et entrez la bande passante maximale pouvant être utilisée, ou sélectionnez *Illimité* pour indiquer qu'il n'y a pas de limite.



. Sur la page _Tier Volumes_, sélectionnez les volumes pour lesquels vous souhaitez configurer la hiérarchisation et lancez la page Tiering Policy :
+
** Pour sélectionner tous les volumes, cochez la case dans la ligne du titre (image:button_backup_all_volumes.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner plusieurs volumes, cochez la case correspondant à chaque volume (image:button_backup_1_volume.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner un seul volume, sélectionnez la ligne (ouimage:screenshot_edit_icon.gif["icône de modification du crayon"] icône) pour le volume.
+
image:screenshot_tiering_initial_volumes.png["Une capture d'écran montrant comment sélectionner un seul volume, plusieurs volumes ou tous les volumes, ainsi que le bouton « Modifier les volumes sélectionnés »."]



. Dans la boîte de dialogue _Stratégie de hiérarchisation_, sélectionnez une stratégie de hiérarchisation, ajustez éventuellement les jours de refroidissement pour les volumes sélectionnés, puis sélectionnez *Appliquer*.
+
link:concept-cloud-tiering.html#volume-tiering-policies["Apprenez-en davantage sur les politiques de tarification par paliers et les jours de refroidissement."].

+
image:screenshot_tiering_initial_policy_settings.png["Capture d'écran montrant les paramètres configurables de la politique de hiérarchisation."]



.Quelle est la prochaine étape ?
Vous pouvez consulter les informations relatives aux données actives et inactives du cluster. link:task-managing-tiering.html["Apprenez-en davantage sur la gestion de vos paramètres de hiérarchisation"].

Vous pouvez également créer un stockage d'objets supplémentaire dans les cas où vous souhaiteriez hiérarchiser les données de certains agrégats d'un cluster vers différents stockages d'objets.  Ou si vous prévoyez d'utiliser FabricPool Mirroring, où vos données hiérarchisées sont répliquées sur un stockage d'objets supplémentaire. link:task-managing-object-storage.html["Apprenez-en davantage sur la gestion des magasins d'objets"].
