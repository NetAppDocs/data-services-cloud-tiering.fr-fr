---
sidebar: sidebar 
permalink: task-tiering-onprem-azure.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, azure, blob, azure blob 
summary: Libérez de l’espace sur vos clusters ONTAP locaux en hiérarchisant les données inactives vers le stockage Azure Blob. 
---
= Hiérarchiser les données des clusters ONTAP locaux vers le stockage Azure Blob dans NetApp Cloud Tiering
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Libérez de l’espace sur vos clusters ONTAP locaux en hiérarchisant les données inactives vers le stockage Azure Blob.  Libérez de l’espace sur vos clusters ONTAP locaux en hiérarchisant les données inactives vers le stockage Azure Blob.



== Démarrage rapide

Commencez rapidement en suivant ces étapes ou faites défiler les sections restantes pour obtenir tous les détails.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["Un"]Préparez-vous à hiérarchiser les données vers le stockage Azure Blob
[role="quick-margin-para"]
Vous avez besoin des éléments suivants :

[role="quick-margin-list"]
* Un cluster ONTAP source sur site exécutant ONTAP 9.4 ou une version ultérieure que vous avez ajouté à la console NetApp et une connexion HTTPS au stockage Azure Blob. https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^] .
* Un agent de console installé dans un réseau virtuel Azure ou sur vos locaux.
* Mise en réseau pour un agent qui permet une connexion HTTPS sortante au cluster ONTAP de votre centre de données, au stockage Azure et au service Cloud Tiering.


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["Deux"]Configurer la hiérarchisation
[role="quick-margin-para"]
Dans la console NetApp , sélectionnez un système ONTAP local, sélectionnez *Activer* pour le service de hiérarchisation et suivez les invites pour hiérarchiser les données vers le stockage Azure Blob.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["Trois"]Configurer les licences
[role="quick-margin-para"]
Une fois votre essai gratuit terminé, payez Cloud Tiering via un abonnement à la carte, une licence BYOL ONTAP Cloud Tiering ou une combinaison des deux :

[role="quick-margin-list"]
* Pour vous abonner depuis la Place de marché Azure, https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["accéder à l'offre Marketplace"^] , sélectionnez *S'abonner*, puis suivez les instructions.
* Pour payer en utilisant une licence Cloud Tiering BYOL, envoyez un e-mail à : ng-cloud-tiering@netapp.com?subject=Licensing [contactez-nous si vous devez en acheter une], puislink:https://docs.netapp.com/us-en/bluexp-digital-wallet/task-manage-data-services-licenses.html["ajoutez-le à la console NetApp"] .




== Exigences

Vérifiez la prise en charge de votre cluster ONTAP , configurez votre réseau et préparez votre stockage d’objets.

L'image suivante montre chaque composant et les connexions que vous devez préparer entre eux :

image:diagram_cloud_tiering_azure.png["Une image d'architecture qui montre le service Cloud Tiering avec une connexion à l'agent de console de votre fournisseur de cloud, l'agent avec une connexion à votre cluster ONTAP et une connexion entre le cluster ONTAP et le stockage d'objets de votre fournisseur de cloud.  Les données actives résident sur le cluster ONTAP , tandis que les données inactives résident dans le stockage d'objets."]


NOTE: La communication entre l'agent de console et le stockage Blob est destinée uniquement à la configuration du stockage d'objets.  L'agent peut résider dans vos locaux, au lieu d'être dans le cloud.



=== Préparez vos clusters ONTAP

Vos clusters ONTAP doivent répondre aux exigences suivantes lors de la hiérarchisation des données vers le stockage Blob Azure.

Plateformes ONTAP prises en charge::
+
--
* Lorsque vous utilisez ONTAP 9.8 et versions ultérieures : vous pouvez hiérarchiser les données des systèmes AFF ou des systèmes FAS avec des agrégats entièrement SSD ou des agrégats entièrement HDD.
* Lorsque vous utilisez ONTAP 9.7 et versions antérieures : vous pouvez hiérarchiser les données des systèmes AFF ou des systèmes FAS avec des agrégats entièrement SSD.


--
Version ONTAP prise en charge:: ONTAP 9.4 ou version ultérieure
Exigences de mise en réseau des clusters::
+
--
* Le cluster ONTAP initie une connexion HTTPS via le port 443 vers le stockage Azure Blob.
+
ONTAP lit et écrit des données vers et depuis le stockage d'objets.  Le stockage d'objets ne s'initialise jamais, il répond simplement.

+
Bien qu’ExpressRoute offre de meilleures performances et des frais de transfert de données inférieurs, il n’est pas nécessaire entre le cluster ONTAP et le stockage Azure Blob.  Mais cela constitue la meilleure pratique recommandée.

* Une connexion entrante est requise depuis l’agent, qui peut résider dans un réseau virtuel Azure ou dans vos locaux.
+
Une connexion entre le cluster et le service Cloud Tiering n'est pas requise.

* Un LIF intercluster est requis sur chaque nœud ONTAP qui héberge les volumes que vous souhaitez hiérarchiser.  Le LIF doit être associé à l'_IPspace_ ONTAP doit utiliser pour se connecter au stockage d'objets.
+
Lorsque vous configurez la hiérarchisation des données, Cloud Tiering vous invite à indiquer l'espace IP à utiliser.  Vous devez choisir l’espace IP auquel chaque LIF est associé.  Il peut s'agir de l'espace IP « par défaut » ou d'un espace IP personnalisé que vous avez créé.  En savoir plus sur https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Les LIF"^] et https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["Espaces IP"^] .



--
Volumes et agrégats pris en charge:: Le nombre total de volumes que Cloud Tiering peut hiérarchiser peut être inférieur au nombre de volumes sur votre système ONTAP .  C'est parce que les volumes ne peuvent pas être hiérarchisés à partir de certains agrégats.  Consultez la documentation ONTAP pour https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["fonctionnalités ou caractéristiques non prises en charge par FabricPool"^] .



NOTE: Cloud Tiering prend en charge les volumes FlexGroup , à partir d' ONTAP 9.5.  La configuration fonctionne de la même manière que n’importe quel autre volume.



=== Découvrez un cluster ONTAP

Vous devez ajouter un système ONTAP sur site à la console NetApp avant de pouvoir commencer la hiérarchisation des données froides.

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Apprenez à découvrir un cluster"^] .



=== Créer ou changer d'agents

Un agent est nécessaire pour hiérarchiser les données vers le cloud.  Lors de la hiérarchisation des données vers le stockage Azure Blob, vous pouvez utiliser un agent qui se trouve dans un réseau virtuel Azure ou dans vos locaux.  Vous devrez soit créer un nouvel agent, soit vous assurer que l’agent actuellement sélectionné réside dans Azure ou sur site.

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["En savoir plus sur les agents"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-azure.html["Déploiement d'un agent dans Azure"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-on-prem.html["Installation d'un agent sur un hôte Linux"^]




=== Vérifiez que vous disposez des autorisations d'agent nécessaires

Si vous avez créé l'agent de console à l'aide de la version 3.9.25 ou supérieure, vous êtes prêt.  Le rôle personnalisé qui fournit les autorisations dont un agent a besoin pour gérer les ressources et les processus au sein de votre réseau Azure sera configuré par défaut.  Voir le https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html#custom-role-permissions["autorisations de rôle personnalisées requises"^] et le https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html#cloud-tiering["autorisations spécifiques requises pour Cloud Tiering"^] .

Si vous avez créé l’agent à l’aide d’une version antérieure, vous devrez modifier la liste des autorisations du compte Azure pour ajouter les autorisations manquantes.



=== Préparer la mise en réseau pour l'agent de la console

Assurez-vous que l’agent de console dispose des connexions réseau requises.  L'agent peut être installé sur site ou dans Azure.

.Étapes
. Assurez-vous que le réseau sur lequel l'agent est installé permet les connexions suivantes :
+
** Une connexion HTTPS via le port 443 au service Cloud Tiering et à votre stockage d'objets Azure Blob(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-azure.html#endpoints-contacted-for-day-to-day-operations["voir la liste des points de terminaison"^] )
** Une connexion HTTPS via le port 443 vers votre LIF de gestion de cluster ONTAP


. Si nécessaire, activez un point de terminaison de service VNet sur le stockage Azure.
+
Un point de terminaison de service VNet vers le stockage Azure est recommandé si vous disposez d’une connexion ExpressRoute ou VPN de votre cluster ONTAP vers le VNet et que vous souhaitez que la communication entre l’agent et le stockage Blob reste dans votre réseau privé virtuel.





=== Préparer le stockage Azure Blob

Lorsque vous configurez la hiérarchisation, vous devez identifier le groupe de ressources que vous souhaitez utiliser, ainsi que le compte de stockage et le conteneur Azure qui appartiennent au groupe de ressources.  Un compte de stockage permet à Cloud Tiering d'authentifier et d'accéder au conteneur Blob utilisé pour la hiérarchisation des données.

Cloud Tiering prend en charge la hiérarchisation vers n'importe quel compte de stockage dans n'importe quelle région accessible via l'agent.

Cloud Tiering prend uniquement en charge les types de comptes de stockage General Purpose v2 et Premium Block Blob.


NOTE: Si vous envisagez de configurer Cloud Tiering pour utiliser un niveau d’accès à moindre coût vers lequel vos données hiérarchisées seront transférées après un certain nombre de jours, vous ne devez sélectionner aucune règle de cycle de vie lors de la configuration du conteneur dans votre compte Azure.  Cloud Tiering gère les transitions du cycle de vie.



== Hiérarchisez les données inactives de votre premier cluster vers le stockage Azure Blob

Après avoir préparé votre environnement Azure, commencez à hiérarchiser les données inactives de votre premier cluster.

.Ce dont vous aurez besoin
https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Un système ONTAP sur site vers la console NetApp"^] .

.Étapes
. Sélectionnez le système ONTAP sur site.
. Cliquez sur *Activer* pour le service de hiérarchisation dans le panneau de droite.
+
Si la destination de hiérarchisation Azure Blob existe en tant que système sur la page Systèmes, vous pouvez faire glisser le cluster sur le système Azure Blob pour lancer l’assistant de configuration.

+
image:screenshot_setup_tiering_onprem.png["Une capture d’écran qui montre l’option Activer qui apparaît sur le côté droit de l’écran après avoir sélectionné un système ONTAP sur site."]

. *Définir le nom du stockage d’objets* : saisissez un nom pour ce stockage d’objets.  Il doit être unique par rapport à tout autre stockage d’objets que vous pouvez utiliser avec des agrégats sur ce cluster.
. *Sélectionner le fournisseur* : Sélectionnez *Microsoft Azure* et sélectionnez *Continuer*.
. *Sélectionner le fournisseur* : Sélectionnez *Microsoft Azure* et sélectionnez *Continuer*.
. Suivez les étapes des pages *Créer un stockage d'objets* :
+
.. *Groupe de ressources* : sélectionnez un groupe de ressources dans lequel un conteneur existant est géré, ou dans lequel vous souhaitez créer un nouveau conteneur pour les données hiérarchisées, puis sélectionnez *Continuer*.
.. *Groupe de ressources* : sélectionnez un groupe de ressources dans lequel un conteneur existant est géré, ou dans lequel vous souhaitez créer un nouveau conteneur pour les données hiérarchisées, puis sélectionnez *Continuer*.
+
Lorsque vous utilisez un agent local, vous devez saisir l’abonnement Azure qui fournit l’accès au groupe de ressources.

.. *Conteneur Azure* : sélectionnez le bouton radio pour ajouter un nouveau conteneur Blob à un compte de stockage ou pour utiliser un conteneur existant.  Sélectionnez ensuite le compte de stockage et choisissez le conteneur existant ou saisissez le nom du nouveau conteneur.  Sélectionnez ensuite *Continuer*.
.. *Conteneur Azure* : sélectionnez le bouton radio pour ajouter un nouveau conteneur Blob à un compte de stockage ou pour utiliser un conteneur existant.  Sélectionnez ensuite le compte de stockage et choisissez le conteneur existant ou saisissez le nom du nouveau conteneur.  Sélectionnez ensuite *Continuer*.
+
Les comptes de stockage et les conteneurs qui apparaissent dans cette étape appartiennent au groupe de ressources que vous avez sélectionné à l’étape précédente.

.. *Cycle de vie du niveau d'accès* : Cloud Tiering gère les transitions du cycle de vie de vos données hiérarchisées.  Les données commencent dans la classe _Hot_, mais vous pouvez créer une règle pour appliquer la classe _Cool_ aux données après un certain nombre de jours.
+
Sélectionnez le niveau d'accès vers lequel vous souhaitez transférer les données hiérarchisées et le nombre de jours avant que les données ne soient attribuées à ce niveau, puis sélectionnez *Continuer*.  Par exemple, la capture d'écran ci-dessous montre que les données hiérarchisées sont attribuées à la classe _Cool_ à partir de la classe _Hot_ après 45 jours dans le stockage d'objets.

+
Si vous choisissez *Conserver les données dans ce niveau d'accès*, les données restent dans le niveau d'accès _Hot_ et aucune règle n'est appliquée. link:reference-azure-support.html["Voir les niveaux d'accès pris en charge"^] .

+
image:screenshot_tiering_lifecycle_selection_azure.png["Une capture d'écran montrant comment sélectionner un autre niveau d'accès qui est attribué à vos données après un certain nombre de jours."]

+
Notez que la règle de cycle de vie est appliquée à tous les conteneurs blob du compte de stockage sélectionné.

.. *Réseau de cluster* : sélectionnez l'espace IP ONTAP doit utiliser pour se connecter au stockage d'objets, puis sélectionnez *Continuer*.
+
La sélection de l'espace IP correct garantit que Cloud Tiering peut établir une connexion d' ONTAP au stockage d'objets de votre fournisseur de cloud.

+
Vous pouvez également définir la bande passante réseau disponible pour télécharger des données inactives vers le stockage d'objets en définissant le « Taux de transfert maximal ».  Sélectionnez le bouton radio *Limité* et entrez la bande passante maximale pouvant être utilisée, ou sélectionnez *Illimité* pour indiquer qu'il n'y a pas de limite.



. Sur la page _Volumes hiérarchisés_, sélectionnez les volumes pour lesquels vous souhaitez configurer la hiérarchisation et lancez la page Politique de hiérarchisation :
+
** Pour sélectionner tous les volumes, cochez la case dans la ligne de titre (image:button_backup_all_volumes.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner plusieurs volumes, cochez la case correspondant à chaque volume (image:button_backup_1_volume.png[""] ) et sélectionnez *Configurer les volumes*.
** Pour sélectionner un seul volume, sélectionnez la ligne (ouimage:screenshot_edit_icon.gif["modifier l'icône du crayon"] icône) pour le volume.
+
image:screenshot_tiering_initial_volumes.png["Une capture d'écran qui montre comment sélectionner un seul volume, plusieurs volumes ou tous les volumes, et le bouton Modifier les volumes sélectionnés."]



. Dans la boîte de dialogue _Politique de hiérarchisation_, sélectionnez une politique de hiérarchisation, ajustez éventuellement les jours de refroidissement pour les volumes sélectionnés et sélectionnez *Appliquer*.
+
link:concept-cloud-tiering.html#volume-tiering-policies["En savoir plus sur les politiques de hiérarchisation des volumes et les jours de refroidissement"] .

+
image:screenshot_tiering_initial_policy_settings.png["Une capture d’écran qui montre les paramètres de stratégie de hiérarchisation configurables."]



.Résultat
Vous avez configuré avec succès la hiérarchisation des données des volumes du cluster vers le stockage d’objets Azure Blob.

.Quelle est la prochaine étape ?
link:task-licensing-cloud-tiering.html["Assurez-vous de vous abonner au service Cloud Tiering"] .

Vous pouvez consulter les informations sur les données actives et inactives du cluster. link:task-managing-tiering.html["En savoir plus sur la gestion de vos paramètres de hiérarchisation"] .

Vous pouvez également créer un stockage d'objets supplémentaire dans les cas où vous souhaitez hiérarchiser les données de certains agrégats d'un cluster vers différents magasins d'objets.  Ou si vous prévoyez d'utiliser FabricPool Mirroring où vos données hiérarchisées sont répliquées vers un magasin d'objets supplémentaire. link:task-managing-object-storage.html["En savoir plus sur la gestion des magasins d'objets"] .
